{% extends 'base.html' %}
{% load static %}
{% load form_tags %}

{% block head %}
<style>
    body {
        background-image: url("{% static 'website/images/Background.png' %}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }

    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .table th, .table td {
        text-align: center;
        vertical-align: middle;
    }

    /* Fixed widths for specific columns */
    .table th:nth-child(1), .table td:nth-child(1) { width: 50px; }  /* No */
    .table th:nth-child(2), .table td:nth-child(2) { width: 120px; } /* Transaction Type */
    .table th:nth-child(3), .table td:nth-child(3) { width: 150px; } /* Item Name */
    .table th:nth-child(4), .table td:nth-child(4) { width: 100px; } /* Item Type */
    .table th:nth-child(5), .table td:nth-child(5) { width: 200px; } /* Description */
    .table th:nth-child(6), .table td:nth-child(6) { width: 120px; } /* Project */
    .table th:nth-child(7), .table td:nth-child(7) { width: 100px; } /* Location */
    .table th:nth-child(8), .table td:nth-child(8) { width: 120px; } /* Requester */
    .table th:nth-child(9), .table td:nth-child(9) { width: 100px; } /* Unit Measure */
    .table th:nth-child(10), .table td:nth-child(10) { width: 80px; } /* Quantity */
    .table th:nth-child(11), .table td:nth-child(11) { width: 100px; } /* Unit Price */
    .table th:nth-child(12), .table td:nth-child(12) { width: 100px; } /* Total Value */
    .table th:nth-child(13), .table td:nth-child(13) { width: 100px; } /* Date */
    .table th:nth-child(14), .table td:nth-child(14) { width: 120px; } /* Reviewer */
    .table th:nth-child(15), .table td:nth-child(15) { width: 100px; } /* Result */
    .table th:nth-child(16), .table td:nth-child(16) { width: 100px; } /* Approval */
    .table th:nth-child(17), .table td:nth-child(17) { width: 100px; } /* Cashier Status */
    .table th:nth-child(18), .table td:nth-child(18) { width: 150px; } /* Comments */

    /* Table cell content handling */
    .table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px; /* Adjust as needed */
    }

    /* Add hover effect to see full content */
    .table td:hover {
        white-space: normal;
        overflow: visible;
        background-color: #f8f9fa;
        position: relative;
        z-index: 1;
    }

    /* Responsive breakpoints */
    @media (max-width: 1400px) {
        .table td {
            max-width: 150px;
        }
    }

    @media (max-width: 992px) {
        .table td {
            max-width: 120px;
        }
    }

    @media (max-width: 768px) {
        .table td {
            max-width: 100px;
        }
    }

    /* Optional: Add horizontal scroll indicator */
    .scroll-indicator {
        display: none;
        text-align: center;
        padding: 10px;
        color: #666;
        font-size: 0.9rem;
    }

    @media (max-width: 1200px) {
        .scroll-indicator {
            display: block;
        }
    }

    .animated-text {
        font-size: 2.5rem;
        color: #ffffff;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        opacity: 0;
        position: relative;
    }

    /* Sliding Panel Styles */
    .sliding-panel {
        position: fixed;
        top: 0;
        right: -100%;
        width: 100%;
        max-width: 500px;
        height: 100%;
        background-color: white;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
        transition: right 0.3s ease-in-out;
        z-index: 1050;
        overflow-y: auto;
        padding: 20px;
    }

    .sliding-panel.open {
        right: 0;
    }

    .panel-content {
        padding: 20px;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    }

    .close-btn:hover {
        color: #333;
    }

    /* Form Styles */
    .sliding-panel form {
        margin-top: 20px;
    }

    .sliding-panel .form-control {
        margin-bottom: 15px;
    }

    /* Responsive adjustments */
    @media (max-width: 576px) {
        .sliding-panel {
            max-width: 100%;
        }
    }

    /* Form Styles */
    .form-control, select {
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 5px;
        transition: border-color 0.3s, box-shadow 0.3s;
        width: 100%;
        background-color: white;
    }

    .form-control:focus, select:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
    }

    select {
        appearance: auto;
        -webkit-appearance: auto;
        -moz-appearance: auto;
        height: 42px;
    }

    select option {
        padding: 10px;
    }

    .form-label {
        font-weight: 500;
        color: #555;
        margin-bottom: 5px;
    }

    .form-text {
        color: #6c757d;
        font-size: 0.875rem;
        margin-top: 5px;
    }

    /* Error Styles */
    .is-invalid {
        border-color: #dc3545;
    }

    .invalid-feedback {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 5px;
    }

    /* Button Styles */
    .btn-primary {
        background-color: #007bff;
        border: none;
        padding: 12px;
        transition: background-color 0.3s;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .btn-secondary {
        background-color: #6c757d;
        border: none;
        padding: 12px;
    }

    .btn-secondary:hover {
        background-color: #545b62;
    }

    /* Scrollbar Styles */
    .panel-content::-webkit-scrollbar {
        width: 8px;
    }

    .panel-content::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .panel-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .panel-content::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Date Picker Styles */
    input[type="date"] {
        position: relative;
        padding: 10px;
        color: #333;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: white;
        cursor: pointer;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        position: absolute;
        right: 10px;
        padding: 5px;
        cursor: pointer;
        opacity: 0.6;
        filter: invert(0.8);
    }

    input[type="date"]::-webkit-calendar-picker-indicator:hover {
        opacity: 1;
    }

    /* Hover effect */
    input[type="date"]:hover {
        border-color: #007bff;
    }

    /* Focus effect */
    input[type="date"]:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
    }

    /* Search Form Styles */
    .search-form {
        margin-bottom: 20px;
    }

    .search-form .input-group {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 5px;
        overflow: hidden;
    }

    .search-form .form-control,
    .search-form .form-select {
        border: 1px solid #ddd;
        padding: 10px 15px;
        height: 45px;
    }

    .search-form .form-control:focus,
    .search-form .form-select:focus {
        border-color: #007bff;
        box-shadow: none;
    }

    .search-form .btn {
        padding: 10px 20px;
        height: 45px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .search-form .btn i {
        font-size: 14px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .search-form .input-group {
            flex-wrap: wrap;
        }
        
        .search-form .form-control,
        .search-form .form-select,
        .search-form .btn {
            width: 100%;
            margin: 5px 0;
            border-radius: 5px !important;
        }
    }

    /* Column Filter Styles */
    .filters th {
        padding: 5px;
        background-color: #f8f9fa;
    }

    .column-filter {
        width: 100%;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    .column-filter:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    /* Make dropdowns more compact */
    .filters select.form-select {
        padding: 0.25rem 2rem 0.25rem 0.5rem;
        height: auto;
    }

    /* Style for active filters */
    .column-filter option:checked {
        background-color: #007bff;
        color: white;
    }

    /* Add these styles to your existing CSS */
    .table th:first-child,
    .table td:first-child {
        width: 50px;
        min-width: 50px;
        background-color: #f8f9fa;
        position: sticky;
        left: 0;
        z-index: 1;
    }

    .table th:first-child {
        z-index: 2;  /* Higher z-index to stay above other headers */
    }

    /* Optional: Add border to make it stand out */
    .table th:first-child,
    .table td:first-child {
        border-right: 2px solid #dee2e6;
    }

    /* Optional: Add hover effect */
    .table tr:hover td:first-child {
        background-color: #e9ecef;
    }

    /* Add Record Button Style */
    .custom-btn {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        transition: all 0.3s ease;
        margin: 0 10px;
    }

    .custom-btn:hover {
        background: linear-gradient(45deg, #0056b3, #004085);
        transform: translateY(-2px);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
    }

    /* Add this at the end of your style section */
    @media (max-width: 991px) {
        .custom-btn {
            margin: 10px 0;
            width: 100%;
        }
    }

    /* Add styles for the clear filters button */
    #clearColumnFilters {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        color: white;
        padding: 8px 16px;
        transition: all 0.3s ease;
    }

    #clearColumnFilters:hover {
        background: linear-gradient(45deg, #20c997, #28a745);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    #clearColumnFilters i {
        margin-right: 5px;
    }

    /* Add animation for the button */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }

    /* Widget Styles */
    .widgets-container {
        position: sticky;
        top: 20px;
        padding-right: 15px;
    }

    .widget {
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        background: white;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .widget:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .widget-content {
        text-align: center;
        position: relative;
        padding-top: 15px;
    }

    .widget-icon {
        font-size: 2rem;
        margin-bottom: 15px;
        display: block;
    }

    .widget h5 {
        margin-bottom: 10px;
        font-weight: 500;
        font-size: 1.1rem;
    }

    .widget h3 {
        margin: 0;
        font-weight: 600;
        font-size: 1.8rem;
        color: white !important;
    }

    /* Specific widget styles */
    .balance-widget {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        color: white;
    }

    .income-widget {
        background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        color: white;
    }

    .expense-widget {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
    }

    .advance-widget {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
    }

    /* Table Enhancements */
    .table {
        font-size: 0.9rem;
    }
    
    .table thead th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        white-space: nowrap;
    }
    
    .table tbody tr:hover {
        background-color: rgba(0,0,0,.02);
    }
    
    .badge {
        font-weight: 500;
        padding: 0.5em 0.8em;
    }
    
    .btn-group .btn {
        padding: 0.25rem 0.5rem;
    }
    
    .btn-group .btn i {
        font-size: 0.875rem;
    }
    
    /* Custom Badge Colors */
    .bg-income-subtle {
        background-color: rgba(25, 135, 84, 0.1);
        color: #198754;
    }
    
    .bg-expense-subtle {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }
    
    .bg-advance-subtle {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }
    
    /* Search Input Enhancement */
    .input-group {
        width: 300px;
    }
    
    .input-group .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    /* Widget Container Alignment */
    .widgets-container {
        height: calc(100vh - 100px);
        overflow-y: auto;
    }
    
    .widget {
        margin-bottom: 20px;
    }
    
    /* Card Header Enhancement */
    .card-header {
        border-bottom: 1px solid rgba(0,0,0,.125);
    }
    
    /* Search Input Styling */
    .search-row {
        flex: 0 0 auto;
    }
    
    .search-form .input-group {
        width: 300px;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .widgets-container {
            height: auto;
            margin-top: 20px;
        }
        
        .search-form .input-group {
            width: 100%;
        }
    }

    /* Stat Cards */
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .stat-card__content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-card__icon {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }

    .stat-card__info {
        flex: 1;
    }

    .stat-card__title {
        color: #6c757d;
        font-size: 0.875rem;
        margin: 0;
        font-weight: 500;
    }

    .stat-card__value {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0.25rem 0 0;
    }

    /* Card Variants */
    .stat-card.balance .stat-card__icon {
        background: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }

    .stat-card.income .stat-card__icon {
        background: rgba(25, 135, 84, 0.1);
        color: #198754;
    }

    .stat-card.expense .stat-card__icon {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }

    .stat-card.advance .stat-card__icon {
        background: rgba(102, 16, 242, 0.1);
        color: #6610f2;
    }

    /* Value Colors */
    .stat-card.balance .stat-card__value { color: #0d6efd; }
    .stat-card.income .stat-card__value { color: #198754; }
    .stat-card.expense .stat-card__value { color: #dc3545; }
    .stat-card.advance .stat-card__value { color: #6610f2; }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .stat-card {
            margin-bottom: 0.75rem;
        }
        
        .stat-card__icon {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
        
        .stat-card__value {
            font-size: 1.125rem;
        }
    }

    .filter-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .filter-section .form-select,
    .filter-section .form-control {
        border-radius: 6px;
        font-size: 0.9rem;
    }
    
    .filter-section .input-group-text {
        background-color: white;
        border-right: none;
    }
    
    .filter-section .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    #toggleFilters {
        transition: all 0.3s ease;
    }
    
    #toggleFilters:hover {
        background-color: #0d6efd;
        color: white;
    }

    /* Quick Search Styling */
    .quick-search .input-group {
        width: 300px;
    }
    
    .quick-search .form-control {
        border-right: none;
    }
    
    .quick-search .btn {
        border-left: none;
    }
    
    .quick-search .form-control:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
    }
    
    .quick-search .form-control:focus + .btn {
        border-color: #198754;
        color: #198754;
    }
    
    /* Filter Button Hover State */
    .btn-outline-success:hover {
        background-color: #198754;
        color: white;
    }
    
    /* Filter Section Submit Button */
    .filter-section .btn-primary {
        background-color: #198754;
        border-color: #198754;
    }
    
    .filter-section .btn-primary:hover {
        background-color: #157347;
        border-color: #157347;
    }

    /* Enhanced Search Styling */
    .search-container {
        position: relative;
        width: 350px;
    }

    .search-wrapper {
        position: relative;
        width: 100%;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .search-wrapper:hover,
    .search-wrapper:focus-within {
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #198754;
        font-size: 16px;
    }

    .search-input {
        width: 100%;
        padding: 12px 40px 12px 40px;
        border: 2px solid transparent;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: #198754;
    }

    .search-clear {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 0;
        font-size: 14px;
        display: none;
    }

    .search-clear:hover {
        color: #dc3545;
    }

    .search-input:not(:placeholder-shown) + .search-clear {
        display: block;
    }

    /* Filter Button Enhancement */
    .btn-filter {
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-filter:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .search-container {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .d-flex.gap-3 {
            flex-direction: column;
            width: 100%;
        }
        
        .btn-filter {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Main Content (Left Side) -->
        <div class="col-md-9">
            <div class="card shadow-sm">
                <div class="card-header bg-white py-3">
                    <div class="d-flex flex-column">
                        <!-- Search and Filter Header -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0 text-success">
                                <i class="fas fa-file-invoice-dollar me-2"></i>Financial Records
                            </h5>
                            <div class="d-flex gap-3">
                                <!-- Enhanced Quick Search -->
                                <div class="search-container">
                                    <div class="search-wrapper">
                                        <i class="fas fa-search search-icon"></i>
                                        <input type="text" id="quickSearch" class="search-input" placeholder="Search records...">
                                        <button class="search-clear" id="clearSearch" type="button">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- Filter Toggle -->
                                <button class="btn btn-success btn-filter" id="toggleFilters">
                                    <i class="fas fa-sliders-h me-2"></i>Filters
                                </button>
                            </div>
                        </div>

                        <!-- Advanced Filters Section -->
                        <div class="filter-section rounded-3 border" id="filterSection" style="display: none;">
                            <form method="GET" class="search-form">
                                <div class="row g-3">
                                    <!-- First Row -->
                                    <div class="col-md-3">
                                        <label class="form-label small">Transaction Type</label>
                                        <select name="transaction_type" class="form-select form-select-sm">
                                            <option value="">All Types</option>
                                            <option value="income">Income</option>
                                            <option value="expense">Expense</option>
                                            <option value="advance">Advance</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">Status</label>
                                        <select name="status" class="form-select form-select-sm">
                                            <option value="">All Status</option>
                                            <option value="approved">Approved</option>
                                            <option value="pending">Pending</option>
                                            <option value="rejected">Rejected</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">Date Range</label>
                                        <select name="date_range" class="form-select form-select-sm">
                                            <option value="">All Time</option>
                                            <option value="today">Today</option>
                                            <option value="week">This Week</option>
                                            <option value="month">This Month</option>
                                            <option value="year">This Year</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small">Amount Range</label>
                                        <select name="amount_range" class="form-select form-select-sm">
                                            <option value="">All Amounts</option>
                                            <option value="0-1000">0 - 1,000 AFN</option>
                                            <option value="1000-10000">1,000 - 10,000 AFN</option>
                                            <option value="10000+">10,000+ AFN</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-flex justify-content-end gap-2 mt-3">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="clearFilters">
                                        <i class="fas fa-eraser me-1"></i>Clear
                                    </button>
                                    <button type="submit" class="btn btn-sm btn-primary">
                                        <i class="fas fa-check me-1"></i>Apply Filters
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="fw-semibold">No</th>
                                    <th class="fw-semibold">Transaction Type</th>
                                    <th class="fw-semibold">Item Name</th>
                                    <th class="fw-semibold">Item Type</th>
                                    <th class="fw-semibold">Description</th>
                                    <th class="fw-semibold">Project</th>
                                    <th class="fw-semibold">Location</th>
                                    <th class="fw-semibold">Requester</th>
                                    <th class="fw-semibold">Unit Measure</th>
                                    <th class="fw-semibold">Quantity</th>
                                    <th class="fw-semibold">Unit Price</th>
                                    <th class="fw-semibold">Total Value</th>
                                    <th class="fw-semibold">Date</th>
                                    <th class="fw-semibold">Reviewer</th>
                                    <th class="fw-semibold">Result</th>
                                    <th class="fw-semibold">Approval</th>
                                    <th class="fw-semibold">Cashier Status</th>
                                    <th class="fw-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in records %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <span class="badge bg-{{ record.transaction_type|lower }}-subtle text-{{ record.transaction_type|lower }}">
                                                {{ record.transaction_type }}
                                            </span>
                                        </td>
                                        <td>{{ record.item_name }}</td>
                                        <td>{{ record.item_type }}</td>
                                        <td class="text-truncate" style="max-width: 200px;" title="{{ record.description }}">
                                            {{ record.description }}
                                        </td>
                                        <td>{{ record.project }}</td>
                                        <td>{{ record.location }}</td>
                                        <td>{{ record.requester }}</td>
                                        <td>{{ record.unit_measure }}</td>
                                        <td>{{ record.quantity }}</td>
                                        <td>{{ record.unit_price|floatformat:2 }} AFN</td>
                                        <td>{{ record.total_value|floatformat:2 }} AFN</td>
                                        <td>{{ record.date|date:"d/m/Y" }}</td>
                                        <td>{{ record.reviewer }}</td>
                                        <td>
                                            <span class="badge {% if record.chief_executive_approval %}bg-success
                                                   {% elif record.deputy_director_approval %}bg-info
                                                   {% elif record.executive_director_approval %}bg-primary
                                                   {% else %}bg-warning{% endif %}">
                                                {% if record.chief_executive_approval %}
                                                    Chief Approved
                                                {% elif record.deputy_director_approval %}
                                                    Deputy Approved
                                                {% elif record.executive_director_approval %}
                                                    Executive Approved
                                                {% else %}
                                                    Pending
                                                {% endif %}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge {% if record.approval_status == 'approved' %}bg-success{% elif record.approval_status == 'rejected' %}bg-danger{% else %}bg-warning{% endif %}">
                                                {{ record.approval_status }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">{{ record.cashier_status }}</span>
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                <a href="{% url 'record_detail' record.id %}" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                {% if user.can_edit_record %}
                                                <a href="{% url 'edit_record' record.id %}" class="btn btn-sm btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="18" class="text-center py-4">
                                            <i class="fas fa-folder-open text-muted mb-2" style="font-size: 2rem;"></i>
                                            <p class="text-muted mb-0">No records found</p>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Summary Widgets (Right Side) -->
        <div class="col-md-3">
            <div class="widgets-container sticky-top" style="top: 20px;">
                <div class="stat-card balance">
                    <div class="stat-card__content">
                        <div class="stat-card__icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-card__info">
                            <p class="stat-card__title">Total Balance</p>
                            <h3 class="stat-card__value">{{ total_balance|floatformat:2 }} AFN</h3>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card income">
                    <div class="stat-card__content">
                        <div class="stat-card__icon">
                            <i class="fas fa-arrow-trend-up"></i>
                        </div>
                        <div class="stat-card__info">
                            <p class="stat-card__title">Total Income</p>
                            <h3 class="stat-card__value">{{ total_income|floatformat:2 }} AFN</h3>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card expense">
                    <div class="stat-card__content">
                        <div class="stat-card__icon">
                            <i class="fas fa-arrow-trend-down"></i>
                        </div>
                        <div class="stat-card__info">
                            <p class="stat-card__title">Total Expense</p>
                            <h3 class="stat-card__value">{{ total_expense|floatformat:2 }} AFN</h3>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card advance">
                    <div class="stat-card__content">
                        <div class="stat-card__icon">
                            <i class="fas fa-hand-holding-dollar"></i>
                        </div>
                        <div class="stat-card__info">
                            <p class="stat-card__title">Total Advance</p>
                            <h3 class="stat-card__value">{{ total_advance|floatformat:2 }} AFN</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleFilters = document.getElementById('toggleFilters');
        const filterSection = document.getElementById('filterSection');
        const clearFilters = document.getElementById('clearFilters');
        const quickSearch = document.getElementById('quickSearch');
        
        // Toggle filters
        toggleFilters.addEventListener('click', function() {
            const isVisible = filterSection.style.display !== 'none';
            filterSection.style.display = isVisible ? 'none' : 'block';
            toggleFilters.classList.toggle('active', !isVisible);
        });
        
        // Quick search functionality
        quickSearch.addEventListener('input', debounce(function(e) {
            document.querySelector('input[name="search"]').value = e.target.value;
            document.querySelector('.search-form').submit();
        }, 500));
        
        // Clear filters
        clearFilters.addEventListener('click', function() {
            const form = document.querySelector('.search-form');
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => input.value = '');
            quickSearch.value = '';
            form.submit();
        });
        
        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    });
</script>
{% endblock %}