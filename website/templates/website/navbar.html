{% load static %}

<style>
/* Modern Financial Platform Branding Styles */
.navbar-brand {
    display: flex;
    align-items: center;
    gap: 15px;
}

.brand-text {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.brand-title {
    font-size: 1.4rem;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #ffffff;
    text-transform: uppercase;
    margin: 0;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}

.brand-subtitle {
    font-size: 0.85rem;
    color: #7dd3fc;
    letter-spacing: 1px;
    text-transform: uppercase;
    opacity: 0.9;
    font-weight: 500;
}

/* Modern Navbar Enhancements */
.navbar {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
}

.navbar-brand img {
    height: 50px;
    width: auto;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

/* Modern Navigation Items */
.navbar-nav .nav-link {
    color: #e2e8f0 !important;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
}

.navbar-nav .nav-link:hover {
    color: #ffffff !important;
    background: rgba(255, 255, 255, 0.1);
}

.navbar-nav .nav-item.active .nav-link {
    background: rgba(255, 255, 255, 0.15);
    color: #ffffff !important;
}

/* Dropdown Styling */
.dropdown-menu {
    background: #ffffff;
    border: none;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    padding: 0.5rem;
}

.dropdown-item {
    color: #1e293b;
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
    font-weight: 500;
    transition: all 0.2s ease;
}

.dropdown-item:hover {
    background: #f1f5f9;
    color: #0f172a;
}

.dropdown-item i {
    color: #64748b;
    width: 1.5rem;
    text-align: center;
    margin-right: 0.5rem;
}

/* Avatar and Badge Styling */
.avatar-circle {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
}

.notification-badge {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 1rem;
    background: #ef4444;
    border: 2px solid #0f172a;
}
</style>

<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="{% url 'website:home' %}">
            <img src="{% static 'website/images/LOGO.png' %}" alt="NSDO Logo" class="brand-logo">
            <div class="brand-text">
                <span class="brand-title">NSDO</span>
                <span class="brand-subtitle">Financial Control</span>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav align-items-center">
                {% if user.is_authenticated %}
                    <!-- Notification Bell -->
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="{% url 'website:notifications' %}">
                            <i class="fas fa-bell"></i>
                            {% if unread_notifications_count > 0 %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    {{ unread_notifications_count }}
                                </span>
                            {% endif %}
                        </a>
                    </li>

                    <!-- Home -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'website:home' %}">
                            <i class="fas fa-home me-1"></i> Home
                        </a>
                    </li>

                    <!-- Financial Records -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="recordsDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-file-invoice-dollar me-1"></i> Financial Records
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="{% url 'website:all_records' %}">
                                    <i class="fas fa-list me-2"></i>All Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:my_records' %}">
                                    <i class="fas fa-folder me-2"></i>My Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:advance_records' %}">
                                    <i class="fas fa-forward me-2"></i>Advance Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:payable_records' %}">
                                    <i class="fas fa-file-invoice me-2"></i>Payable Records
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:balance_entries' %}">
                                    <i class="fas fa-balance-scale me-2"></i>Balance Entries
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:income_records' %}">
                                    <i class="fas fa-arrow-up me-2"></i>Income Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:expense_records' %}">
                                    <i class="fas fa-arrow-down me-2"></i>Expense Records
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:approved_records' %}">
                                    <i class="fas fa-check-circle me-2"></i>Approved Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:rejected_records' %}">
                                    <i class="fas fa-times-circle me-2"></i>Rejected Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:pending_records' %}">
                                    <i class="fas fa-clock me-2"></i>Pending Records
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- Dashboard -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'website:dashboard' %}">
                            <i class="fas fa-chart-line me-1"></i> Dashboard
                        </a>
                    </li>

                    <!-- User Management -->
                    {% if user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:user_list' %}">
                            <i class="fas fa-users me-1"></i> User Management
                        </a>
                    </li>
                    {% endif %}

                    <!-- Add Record -->
                    {% if user.user_type in 'data_entry,cashier' %}
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="offcanvas" data-bs-target="#addRecordSlideMenu">
                            <i class="fas fa-plus-circle me-1"></i> Add Record
                        </a>
                    </li>
                    {% endif %}

                    <!-- User Profile Dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userMenu" role="button" data-bs-toggle="dropdown">
                            <div class="me-2">
                                <div class="avatar-circle">
                                    {{ user.username|make_list|first|upper }}
                                </div>
                            </div>
                            <span class="d-none d-md-inline">{{ user.get_full_name|default:user.username }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <div class="px-4 py-3">
                                    <div class="fw-bold">{{ user.get_full_name|default:user.username }}</div>
                                    <div class="text-muted">{{ user.get_user_type_display }}</div>
                                    <div class="text-muted small">{{ user.email }}</div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{% url 'accounts:profile' %}">
                                    <i class="fas fa-user me-2"></i>My Profile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:my_records' %}">
                                    <i class="fas fa-folder me-2"></i>My Records
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'website:activity_list' %}">
                                    <i class="fas fa-history me-2"></i>Activity Log
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{% url 'accounts:change_password' user.pk %}">
                                    <i class="fas fa-key me-2"></i>Change Password
                                </a>
                            </li>
                            <li>
                                <form method="post" action="{% url 'website:logout' %}" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item text-danger">
                                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:login' %}">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- Modern Sliding Menu 2024 -->
<div class="offcanvas offcanvas-end modern-slide" tabindex="-1" id="addRecordSlideMenu" aria-labelledby="addRecordSlideMenuLabel">
    <!-- Header -->
    <div class="offcanvas-header">
        <div class="d-flex align-items-center">
            <div class="slide-menu-icon me-2">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div>
                <h5 class="offcanvas-title mb-0" id="addRecordSlideMenuLabel">Add New Record</h5>
                <small class="text-muted">Enter transaction details below</small>
            </div>
        </div>
        <button type="button" class="btn-close-modern" data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Progress Indicator -->
    <div class="form-progress-wrapper">
        <div class="form-progress-bar" style="width: 0%"></div>
    </div>

    <!-- Body with Modern Scroll -->
    <div class="offcanvas-body modern-scroll">
        <div class="slide-menu-content">
            {% include 'includes/add_record_form.html' %}
        </div>
    </div>

    <!-- Loading Overlay with Modern Spinner -->
    <div class="loading-overlay modern">
        <div class="loading-content">
            <div class="spinner-wrapper">
                <div class="spinner-ring"></div>
            </div>
            <div class="loading-text">Processing...</div>
        </div>
    </div>
</div>

<!-- Sliding Menu Styles -->
<style>
/* Modern Sliding Menu Styles 2024 */
.modern-slide {
    width: 500px !important;
    background: #ffffff;
    box-shadow: -5px 0 30px rgba(0, 0, 0, 0.1);
    border: none;
}

/* Header Styling */
.modern-slide .offcanvas-header {
    padding: 1.5rem;
    background: #fff;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
}

.slide-menu-icon {
    width: 40px;
    height: 40px;
    background: #f8f9fa;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: #0d6efd;
}

.btn-close-modern {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: none;
    background: #f8f9fa;
    color: #495057;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.btn-close-modern:hover {
    background: #e9ecef;
    color: #212529;
}

/* Progress Bar */
.form-progress-wrapper {
    height: 4px;
    background: #f1f3f5;
    position: relative;
}

.form-progress-bar {
    height: 100%;
    background: #0d6efd;
    transition: width 0.3s ease;
}

/* Modern Scroll Styling */
.modern-scroll {
    padding: 1.5rem;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #dee2e6 #fff;
}

.modern-scroll::-webkit-scrollbar {
    width: 6px;
}

.modern-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.modern-scroll::-webkit-scrollbar-thumb {
    background-color: #dee2e6;
    border-radius: 3px;
}

/* Content Wrapper */
.slide-menu-content {
    max-width: 100%;
    margin: 0 auto;
}

/* Modern Form Field Styling */
.modern-slide .form-control,
.modern-slide .form-select {
    border-radius: 8px;
    border: 1px solid #dee2e6;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    transition: all 0.2s ease;
}

.modern-slide .form-control:focus,
.modern-slide .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15);
}

.modern-slide .form-label {
    font-weight: 500;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: #495057;
}

/* Loading Overlay */
.loading-overlay.modern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1050;
}

.loading-overlay.show {
    display: flex;
}

/* Animations */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.modern-slide {
    animation: slideIn 0.3s ease-out;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const addRecordSlideMenu = document.getElementById('addRecordSlideMenu');
    const loadingOverlay = document.querySelector('.loading-overlay');
    const form = document.getElementById('recordForm');
    const progressBar = document.querySelector('.form-progress-bar');
    
    // Function to update progress bar
    function updateProgress() {
        const requiredFields = form.querySelectorAll('[required]');
        const filledFields = Array.from(requiredFields).filter(field => field.value.trim() !== '');
        const progress = (filledFields.length / requiredFields.length) * 100;
        progressBar.style.width = `${progress}%`;
    }

    // Add input event listeners to all form fields
    form.querySelectorAll('input, select, textarea').forEach(field => {
        field.addEventListener('input', updateProgress);
    });

    // Show loading overlay when form is submitted
    form.addEventListener('submit', function(event) {
        if (this.checkValidity()) {
            loadingOverlay.classList.add('show');
            // Show success toast after submission
            setTimeout(() => {
                showToast('Record added successfully!', 'success');
            }, 1000);
        }
    });

    // Reset form when sliding menu is closed
    addRecordSlideMenu.addEventListener('hidden.bs.offcanvas', function() {
        form.reset();
        loadingOverlay.classList.remove('show');
        progressBar.style.width = '0%';
        form.classList.remove('was-validated');
    });

    // Toast notification function
    window.showToast = function(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `modern-toast ${type}`;
        toast.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                <div class="toast-message">${message}</div>
            </div>
        `;
        
        // Create toast container if it doesn't exist
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }
        
        toastContainer.appendChild(toast);
        setTimeout(() => {
            toast.remove();
        }, 3000);
    };
});
</script>